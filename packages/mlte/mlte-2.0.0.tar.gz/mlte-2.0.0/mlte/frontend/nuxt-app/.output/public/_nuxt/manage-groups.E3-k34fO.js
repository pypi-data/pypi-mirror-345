import{n as T,q as $,o as r,c as u,F as q,s as P,a as n,t as m,b,w as h,d as f,u as L,r as E,v as D,x as R,y as G,z as N,A as S,B as M,C as z}from"./entry.DZxwSL9U.js";import{u as I}from"./fetch.DQpSruNE.js";import{r as j}from"./util.B0gNYUhE.js";import{r as w,h as A}from"./http-error-handling.BbcmLHJS.js";const H={class:"table usa-table usa-table--borderless"},J=n("thead",null,[n("tr",null,[n("th",{"data-sortable":"",scope:"col",role:"columnheader"},"Name"),n("th",{"data-sortable":"",scope:"col",role:"columnheader"},[f(" Permissions "),n("br"),f(" (Resource Type - Resource ID - Method) ")]),n("th",{"data-sortable":"",scope:"col",role:"columnheader"},"Actions")])],-1),K={class:"inline-input-left",style:{"max-width":"50ch"}},Q={key:0},W={key:1},X=T({__name:"group-list",props:{modelValue:{type:Array,required:!0,default:[]}},emits:["addGroup","editGroup","deleteGroup"],setup(y,{emit:V}){const _=y;return(c,d)=>{const v=$("UsaButton");return r(),u("table",H,[J,(r(!0),u(q,null,P(_.modelValue,(i,p)=>(r(),u("tr",{key:p},[n("td",null,m(i.name),1),n("td",null,[(r(!0),u(q,null,P(i.permissions,(s,g)=>(r(),u("div",{key:g},[n("div",K,[s.resource_id===null?(r(),u("span",Q,m(s.resource_type)+" - (All) - "+m(s.method),1)):(r(),u("span",W,m(s.resource_type)+" - "+m(s.resource_id)+" - "+m(s.method),1))])]))),128))]),n("td",null,[b(v,{class:"secondary-button",onClick:s=>c.$emit("editGroup",i)},{default:h(()=>[f(" Edit ")]),_:2},1032,["onClick"]),b(v,{class:"usa-button usa-button--secondary",onClick:s=>c.$emit("deleteGroup",i.name)},{default:h(()=>[f(" Delete ")]),_:2},1032,["onClick"])])]))),128))])}}}),Y={key:0},Z={class:"section-header"},O={key:1},ee=n("label",{class:"usa-label"},"Permissions",-1),te={class:"multi-line-checkbox-div"},oe={key:0},ae={key:1},re={class:"submit-footer"},se=T({__name:"group-edit",props:{modelValue:{type:Object,required:!0},newGroupFlag:{type:Boolean,required:!0,default:!1}},emits:["cancel","submit"],async setup(y,{emit:V}){let _,c;const d=y,v=N(),i=L("token"),p=E({name:!1}),s=E([]),{data:g}=([_,c]=D(()=>I(v.public.apiPath+"/groups/permissions/details",{method:"GET",headers:{Authorization:"Bearer "+i.value}},"$MdsRazCG4z")),_=await _,c(),_);g.value&&g.value.forEach(o=>{s.value.push({resource_id:o.resource_id,resource_type:o.resource_type,method:o.method,selected:!1})}),s.value.forEach(o=>{d.modelValue.permissions.find(a=>a.resource_id===o.resource_id&&a.resource_type===o.resource_type&&a.method===o.method)&&(o.selected=!0)});function B(o,a){if(o)d.modelValue.permissions.push({resource_id:a.resource_id,resource_type:a.resource_type,method:a.method});else{const t=d.modelValue.permissions.find(k=>k.name===a.name&&k.resource_type===a.resource_type&&k.method===a.method),e=d.modelValue.permissions.indexOf(t);d.modelValue.permissions.splice(e,1)}}function U(){p.value=j(p.value);let o=!1;d.newGroupFlag&&d.modelValue.name.trim()===""&&(p.value.name=!0,o=!0),!o&&emit("submit",d.modelValue)}return(o,a)=>{const t=$("UsaTextInput"),e=$("UsaCheckbox"),k=$("UsaButton");return r(),u("div",null,[y.newGroupFlag?R("",!0):(r(),u("div",Y,[n("h2",Z,m(y.modelValue.name),1)])),y.newGroupFlag?(r(),u("div",O,[b(t,{modelValue:y.modelValue.name,"onUpdate:modelValue":a[0]||(a[0]=l=>y.modelValue.name=l),error:G(p).name},{label:h(()=>[f(" Group Name ")]),"error-message":h(()=>[f(" Group name is required ")]),_:1},8,["modelValue","error"])])):R("",!0),ee,n("div",te,[(r(!0),u(q,null,P(G(s),(l,x)=>(r(),u("span",{key:x,class:"multiple-per-line-checkbox"},[b(e,{modelValue:l.selected,"onUpdate:modelValue":[C=>l.selected=C,C=>B(l.selected,l)]},{default:h(()=>[l.resource_id===null?(r(),u("span",oe,m(l.resource_type)+" - (All) - "+m(l.method),1)):(r(),u("span",ae,m(l.resource_type)+" - "+m(l.resource_id)+" - "+m(l.method),1))]),_:2},1032,["modelValue","onUpdate:modelValue"])]))),128))]),n("div",re,[b(k,{class:"primary-button",onClick:a[1]||(a[1]=l=>o.$emit("cancel"))},{default:h(()=>[f(" Cancel ")]),_:1}),b(k,{class:"primary-button",onClick:U},{default:h(()=>[f(" Save ")]),_:1})])])}}}),ue=n("title",null,"Manage Groups",-1),le={key:0},ne={key:1},_e=T({__name:"manage-groups",setup(y){const V=N(),_=L("token"),c=E(!1),d=E(!1),v=E([]),i=E({});p();async function p(){await $fetch(V.public.apiPath+"/groups/details",{retry:0,method:"GET",headers:{Authorization:"Bearer "+_.value},onRequestError(){w()},onResponse({response:t}){t.ok&&(v.value=t._data)},onResponseError({response:t}){A(t.status,t._data.error_description)}})}function s(){i.value={name:"",permissions:[]}}function g(){s(),c.value=!0,d.value=!0}function B(t){i.value=t,c.value=!0,d.value=!1}async function U(t){confirm("Are you sure you want to delete the group: "+t+"?")&&await $fetch(V.public.apiPath+"/group/"+t,{retry:0,method:"DELETE",headers:{Authorization:"Bearer "+_.value},onRequestError(){w()},onResponse({response:e}){e.ok&&p()},onResponseError({response:e}){A(e.status,e._data.error_description)}})}function o(){confirm("Are you sure you want to cancel? All changes will be lost.")&&(c.value=!1,s())}async function a(t){try{d.value?await $fetch(V.public.apiPath+"/group",{retry:0,method:"POST",headers:{Authorization:"Bearer "+_.value},body:t,onRequestError(){w()},onResponse({response:e}){e.ok&&p()},onResponseError({response:e}){A(e.status,e._data.error_description)}}):await $fetch(V.public.apiPath+"/group",{retry:0,method:"PUT",headers:{Authorization:"Bearer "+_.value},body:t,onRequestError(){w()},onResponse({response:e}){e.ok&&p()},onResponseError({response:e}){A(e.status,e._data.error_description)}})}catch{console.log("Error in submit.");return}alert("Group has been saved successfully."),s(),c.value=!1}return(t,e)=>{const k=$("UsaButton"),l=X,x=se,C=M;return r(),S(C,{name:"base-layout"},{"page-title":h(()=>[f("Manage Groups")]),default:h(()=>[ue,G(c)?R("",!0):(r(),u("div",le,[b(k,{class:"secondary-button sub-header-float-button",onClick:g},{default:h(()=>[f(" Add Group ")]),_:1}),b(l,{modelValue:G(v),"onUpdate:modelValue":e[0]||(e[0]=F=>z(v)?v.value=F:null),onEditGroup:B,onDeleteGroup:U},null,8,["modelValue"])])),G(c)?(r(),u("div",ne,[b(x,{modelValue:G(i),"onUpdate:modelValue":e[1]||(e[1]=F=>z(i)?i.value=F:null),"new-group-flag":G(d),onCancel:o,onSubmit:a},null,8,["modelValue","new-group-flag"])])):R("",!0)]),_:1})}}});export{_e as default};
