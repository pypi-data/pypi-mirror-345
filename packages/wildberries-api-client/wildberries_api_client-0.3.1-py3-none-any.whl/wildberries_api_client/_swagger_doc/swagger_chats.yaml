openapi: 3.0.1
info:
  title: "hat s pokupatelami"
  version: ""
  description: >
    hat pozvolaet prodavcam i pokupatelam obhatsa napramuu.
    <br>Pokupateli mogut obrahatsa s voprosami po tovaram ili pretenziami. Rekomenduem otvehat na soobhenia v hate v tehenie 10 dnei.
    <br>hat vsegda nahinaet pokupatel. V odnom hate mohno obhatsa tolko s odnim pokupatelem. 
    <blockquote class="spoiler">
        <p class="descr">Obrabotka zaavok na vozvrat tovara dostupna tolko v <a class="link" target="_blank" href="https://seller.wildberries.ru/chat-with-clients">veb-versii hatov s pokupatelami</a>.</p>
      </blockquote>
      <br> 
    <p>Rabota s hatami:
    <br>1. <a href="./#/paths/~1api~1v1~1seller~1chats/get">Poluhite spisok hatov</a>. Sohranite ID hatov v svoei baze dannyh — eto pozvolit obnovlat informaciu o hatah pri poluhenii sobytii.
    <br>2. <a href="./#/paths/~1api~1v1~1seller~1events/get">Poluhite sobytia hatov</a>: soobhenia i vozvraty. U novyh hatov znahenie pola <code>isNewChat</code> budet <code>true</code>.
    <br>3. <a href="./#/paths/~1api~1v1~1seller~1message/post">Otpravlaite soobhenia v hat</a>.</p>
security:
- HeaderApiKey: []

paths:
  /api/v1/seller/chats:
    servers:
        - url: https://buyer-chat-api.wildberries.ru
    get:
      security:
        - HeaderApiKey: []
      summary: Spisok hatov
      description: |
        Vozvrahaet spisok vseh hatov prodavca.

        Maksimum 10 zaprosov za 10 sekund
      responses:
        "200":
          description: Uspehno
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ChatsResponse'
              examples:
                ResponseChats:
                  value: {"result":[{"chatID":"1:361b656c-5c0e-295b-db03-3d5b4d454c32","replySign":"1:361b656c-5c0e-295b-db03-3d5b4d454c32:45734505:238d4d4925998ce295632034545f2fdf88892414c0f24bb48ac5d89f7866cff95022ef33d6563575d656bce676e4d36b48ed6084997347e55601646af6b37d96","clientID":"12345","clientName":"Ivan"},{"chatID":"1:578903a4-c140-b95b-9d51-896c58ab22dc","replySign":"1:578903a4-c140-b95b-9d51-896c58ab22dc:60012000:8b42800e4be81b56071bfac84a01b1da5a79f7b7eea2a08c3a7efe7e5d63face7240b9036d4a21ce9fe1eeeda1d7cfe27d241edced755267304922f3eb935467","clientID":"987654","clientName":"Vladislav"}],"errors":null}
        "400":
          description: Nekorrektnyi zapros
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        401:
          $ref: "../../../../openapi/ru/responses/401.yaml"
        "403":
          description: Dostup zaprehen
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        "429":
          $ref: "../../../../openapi/ru/responses/429.yaml"
        "500":
          description: Vnutrennaa ohibka servera
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /api/v1/seller/events:
    get:
      servers:
        - url: https://buyer-chat-api.wildberries.ru
      security:
        - HeaderApiKey: []
      summary: Sobytia hatov
      description: > 
        Vozvrahaet spisok sobytii vseh hatov.
        
        htoby poluhit vse sobytia:
        <br>1. Sdelaite pervyi zapros bez parametra `next`.
        <br>2. Povtoraite zapros so znaheniem parametra `next` iz otveta na predyduhii zapros, poka `totalEvents` ne stanet ravnym `0`. Eto budet oznahat, hto vy poluhili vse sobytia.
        
        <br>htoby poluhat tolko novye sobytia, ukahite parametr `next` so znaheniem pola `addTimestamp` iz poslednego poluhennogo sobytia.
        <br>
        Maksimum 10 zaprosov za 10 sekund
      parameters:
      - name: next
        in: query
        description: |
          Paginator. S kakogo momenta poluhit sleduuhii paket dannyh.<br>Format Unix timestamp **s millisekundami**
        schema:
          type: integer
      responses:
        "200":
          description: Uspehno
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EventsResponse'
              example: {"result":{"next":1698045576000,"newestEventTime":"2023-10-23T07:19:36Z","oldestEventTime":"2023-10-23T05:02:20Z","totalEvents":4,"events":[{"chatID":"1:1e265a58-a120-b178-008c-60af2460207c","eventID":"55adee45-11f0-33b6-a847-6ccc7c78b2ec","eventType":"message","isNewChat":true,"message":{"attachments":{"goodCard":{"date":"2023-10-18T11:46:01.528526Z","needRefund":false,"nmID":12345678,"price":500,"priceCurrency":"RUB","rid":"2fb52cd9e25e52538a5f05994e688ae5","size":"0","statusID":11},"files":[{"contentType":"application/pdf","date":"2023-10-23T08:02:19.594Z","name":"hek.pdf","url":"https://chat-basket-01.wbbasket.ru/vol0/part3265/fb25c9e9-cae8-52db-b68e-736c1896a3f5/pdf/0380e781-281e-41b5-8ae1-ce281f15a4a7.pdf","size":1046143}],"images":[{"date":"2023-10-23T08:02:20.717Z","url":"https://chat-basket-01.wbbasket.ru/vol0/part2345/fb89c9e9-cae8-52db-b68e-736c1466a3f5/jpg/0823ff24-821e-40e9-8cdf-0a2b5fd86a32.jpg"}]},"text":"Zdravstvuite! U mena vopros po tovaru \"Albom, brend Ekonom, artikul 13480414, tovar poluhen 18.10.2023\""},"source":"rusite","addTimestamp":1698037340000,"addTime":"2023-10-23T05:02:20Z","replySign":"1:1e265a58-a120-b178-008c-60af2460207c:66f136e919a8207e136757754f253189bfb9ae1ad9da9170c9d5c478626663908888c370216525bef51c0ca8d77952e05c9c17f9b63ab00374c5555b42efc07d","sender":"client","clientID":"186132","clientName":"Alena"},{"chatID":"1:1e265a58-a120-b178-008c-60af2460207c","eventID":"cef95d3c-0345-4dc9-b6df-4c8c57a176a9","eventType":"message","message":{"text":"Zdravstvuite! Prihel ne tot cvet. Mohno vernut i zakazat drugoi tovar?"},"source":"rusite","addTimestamp":1698037387000,"addTime":"2023-10-23T05:03:07Z","sender":"client","clientID":"186132","clientName":"Alena"},{"chatID":"1:1e265a58-a120-b178-008c-60af2460207c","eventID":"fd22e5bf-64fd-43f7-b3a0-ad29uu027f97","eventType":"message","message":{"text":"Zdravstvuite. Da, seihas oformim vozvrat."},"source":"seller-public-api","addTimestamp":1698038124000,"addTime":"2023-10-23T05:15:24Z","sender":"seller"},{"chatID":"1:1e265a58-a120-b178-008c-60af2460207c","eventID":"cef95d3c-0345-4dc9-b6df-4c8c75a176a7","eventType":"refund","refund":{"actionType":"sellerRequestRefund","price":500,"priceCurrency":"RUB","rid":"2fb52cd9e25e52538a5f05994e688ae5"},"addTimestamp":1698045576000,"addTime":"2023-10-23T07:19:36Z","sender":"seller"}]},"errors":null}
        "400":
          description: Nekorrektnyi zapros
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                IncorrectNextParameter:
                  description: Tip znahenia ili ego velihina ne korrektny
                  value: {"error":"Invalid number"}                
                IncorrectNextParameter1:
                  description: Nedopustimoe znahenie 0
                  value: {"error":"Invalid value for \"next\""}
        401:
          $ref: "../../../../openapi/ru/responses/401.yaml"
        "403":
          description: Dostup zaprehen
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        "429":
          $ref: "../../../../openapi/ru/responses/429.yaml"
        "500":
          description: Vnutrennaa ohibka servera
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /api/v1/seller/message:
    post:
      servers:
        - url: https://buyer-chat-api.wildberries.ru
      security:
        - HeaderApiKey: []
      summary: Otpravit soobhenie
      description: >
        Otpravlaet soobhenia pokupatelu.

        Maksimum 10 zaprosov za 10 sekund
      
      requestBody:
        content:
          multipart/form-data:
            schema:
              required:
              - replySign
              type: object
              properties:
                replySign:
                  maxLength: 255
                  type: string
                  description: >
                    Podpis hata. Mohno poluhit iz [informacii po hatu](./#/paths/~1api~1v1~1seller~1chats/get) ili [dannyh sobytia](./#/paths/~1api~1v1~1seller~1events/get), esli v sobytii est pole `"isNewChat": true`.
                message:
                  maxLength: 1000
                  type: string
                  description: Tekst soobhenia. Maksimum 1000 simvolov.
                file:
                  type: array
                  description: |
                    Faily, format JPEG, PDF ili PNG, maksimalnyi razmer — 5 Mb kahdyi. Maksimalnyi summarnyi razmer failov — 30 Mb.
                  items:
                    type: string
                    format: binary
        required: true
      responses:
        "200":
          description: Uspehno
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MessageResponse'
              example: {"result":{"addTime":1712848270018,"chatID":"1:641b623c-5c0e-295b-db03-3d5b4d484c32"},"errors":[]}
        "400":
          description: Nekorrektnyi zapros
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                InvalidSignature:
                  description: Podpis nekorrektna
                  value: {"error":"Invalid signature"}
                InvalidFileSize:
                  description: Razmer faila prevyhaet dopustimyi
                  value: {"error":"A24FA09844E: attachment too big. Max size: 5MiB"}

                UnsupportedFilesType:
                  description: Tip faila ne podderhivaetsa
                  value: {"error":"4A9F2544E29: \"video_2023-07-25_10-54-09.mp4\" has unsupported mime type"}

                InvalidMessage:
                  description: Znahenie parametra message nekorrektno
                  value: {"error":"Invalid value for \"message\""}
        401:
          $ref: "../../../../openapi/ru/responses/401.yaml"
        "403":
          description: Dostup zaprehen
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        "429":
          $ref: "../../../../openapi/ru/responses/429.yaml"
        "500":
          description: Vnutrennaa ohibka servera
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
components:
  schemas:
    Chat:
      type: object
      properties:
        chatID:
          type: string
          description: ID hata
        replySign:
          type: string
          description: |
            Podpis hata. Trebuetsa pri [otpravke soobhenia](./#/paths/~1api~1v1~1seller~1message/post)
        clientID:
          type: string
          description: ID pokupatela
        clientName:
          type: string
          description: Ima pokupatela
    ChatsResponse:
      type: object
      properties:
        result:
          type: array
          items:
            $ref: '#/components/schemas/Chat'
        errors:
          description: Ohibki, esli est
    Error:
      type: object
      properties:
        error:
          type: string
    Event:
      type: object
      properties:
        chatID:
          type: string
          description: ID hata
        eventID:
          type: string
          description: ID sobytia
        eventType:
          $ref: '#/components/schemas/EventType'
        isNewChat:
          type: boolean
          description: |
            Priznak novogo hata:
            - `false` — hat ne novyi 
            - `true` — hat novyi
        message:
          type: object
          description: Dannye soobhenia 
          properties:
            attachments:
              $ref: '#/components/schemas/EventAttachments'
            text:
              type: string
              description: Tekst soobhenia
        refund:
          $ref: '#/components/schemas/Refund'
        source:
          type: string
          description: |
            Istohnik otpravki soobhenia: 
            - `seller-portal` — portal prodavcov 
            - `seller-public-api` — API hata s pokupatelami  
            - `rusite` — portal pokupatelei
            - `global` — portal `global.wildberries.ru` 
            - `ios` —  mobilnaa operacionnaa sistema ot **Apple**  
            - `android` — operacionnaa sistema **Android** ot **Google**
        addTimestamp:
          type: integer
          description: Vrema poavlenia sobytia na servere. Format Unix timestamp
        addTime:
          type: string
          description: Vrema poavlenia sobytia na servere v UTC
        replySign:
          type: string
          description: |
            Podpis hata. Dostupna tolko pri `"isNewChat": true`. Trebuetsa pri [otpravke soobhenia](./#/paths/~1api~1v1~1seller~1message/post)
        sender:
          $ref: '#/components/schemas/Sender'
        clientID:
          type: string
          description: ID pokupatela
        clientName:
          type: string
          description: Ima pokupatela
    EventAttachments:
      type: object
      description: Vlohenia
      properties:
        goodCard:
          $ref: '#/components/schemas/GoodCard'
        files:
          type: array
          description: Faily
          items:
            $ref: '#/components/schemas/File'
        images:
          type: array
          description: Izobrahenia
          items:
            $ref: '#/components/schemas/Image'
    EventType:
      type: string
      description: |
        Tip sobytia: 
        - `message` — soobhenie 
        - `refund` — vozvrat
      enum:
      - message
      - refund
    File:
      type: object
      properties:
        contentType:
          type: string
          description: Tip faila
        date:
          type: string
          description: Data zagruzki faila
        name:
          type: string
          description: Nazvanie faila
        url:
          type: string
          description: URL dla poluhenia faila
        size:
          type: integer
          description: Razmer faila v baitah
    GoodCard:
      type: object
      description: Informacia o zakaze
      properties:
        date:
          type: string
          description: Data zakaza
        needRefund:
          type: boolean
          description: |
            Zaprohen li vozvrat tovara: 
            - `false` — ne zaprohen
            - `true` — zaprohen
        nmID:
          type: integer
          description: Artikul WB
        price:
          type: integer
          description: Stoimost zakaza
        priceCurrency:
          type: string
          description: Valuta
        rid:
          type: string
          description: Unikalnyi ID zakaza v WB
        size:
          type: string
          description: Razmer tovara
        statusID:
          type: integer
          description: |
            Status tovara:
            - `0` — Tovar aktivnyi
            - `1` — Tovar oformlen
            - `2` — Tovar sobiraetsa 
            - `3` — Tovar v puti
            - `4` — Tovar ohidaet v PVZ 
            - `5` — Tovar u kurera
            - `10` — Tovar v arhive 
            - `11` — Tovar vykuplen 
            - `12` — Tovar otmenen 
            - `13` — Oformlen vozvrat 
            - `14` — Tovar otmenen (net na sklade)
    Image:
      type: object
      description: Izobrahenie 
      properties:
        date:
          type: string
          description: Data zagruzki izobrahenia
        url:
          type: string
          description: URL dla poluhenia izobrahenia
    MessageResponse:
      type: object
      properties:
        errors:
          type: array
          description: Ohibki zagruzki failov, esli est
          items:
            type: string
        result:
          type: object
          properties:
            addTime:
              type: integer
              description: Vrema zagruzki
            chatID:
              type: string
              description: ID hata
    Refund:
      type: object
      description: Vozvrat tovara
      properties:
        actionType:
          $ref: '#/components/schemas/RefundActionType'
        price:
          type: integer
          description: Stoimost zakaza
        priceCurrency:
          type: string
          description: Valuta
        rid:
          type: string
          description: Unikalnyi ID zakaza v WB
    RefundActionType:
      description: |
        Deistvie prodavca po vozvratu: 
        - `sellerRequestRefund` — prodavec zaprosil vozvrat tovara 
        - `sellerRejectRefund` — prodavec otklonil vozvrat tovara 
        - `sellerAcceptFullRefund` — prodavec odobril vozvrat tovara 
        - `sellerAcceptRefundInOffice` — prodavec odobril vozvrat tovara na PVZ 
      type: string
      enum:
      - sellerRequestRefund 
      - sellerRejectRefund
      - sellerAcceptFullRefund
      - sellerAcceptRefundInOffice
    Sender:
      type: string
      description: |
        Otpravitel: 
        - `client` — pokupatel 
        - `seller` — prodavec  
        - `wb` — Wildberries 
      enum:
      - client
      - seller
      - wb
    EventsResponse:
      type: object
      properties:
        result:
          $ref: '#/components/schemas/EventsResult'
        errors:
          description: Ohibki, esli est
    EventsResult:
      type: object
      properties:
        next:
          type: integer
          description: Paginator. Znahenie pola neobhodimo ukazat v zaprose dla poluhenia sleduuhego paketa dannyh.
          format: Unix timestamp
        newestEventTime:
          description: Vrema noveihego sobytia v otvete
          type: string
          format: RFC 3339
        oldestEventTime:
          description: Vrema stareihego sobytia v otvete
          type: string
          format: RFC 3339
        totalEvents:
          type: integer
          description: Kolihestvo sobytii
        events:
          type: array
          items:
            $ref: '#/components/schemas/Event'
  securitySchemes:
    HeaderApiKey:
      type: apiKey
      name: Authorization
      in: header
          

