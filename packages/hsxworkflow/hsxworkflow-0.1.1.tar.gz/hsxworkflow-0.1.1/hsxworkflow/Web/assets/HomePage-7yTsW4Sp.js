import{r as L,c as y,o as M,i as U,a as O,b as d,d as a,F as T,e as z,u as Q,f as X,g as p,w as t,h as n,j as s,E as Y,k as Z,l as S,m as v,n as b,p as oo,q as c,s as to,t as W,v as eo,x as r,y as so,z as lo,A as no,B as ro,C as ao,D as co,G as _o,H as uo,I as fo,J as io,K as ko,L as wo}from "./index-DU1D7W6J.js";import{_ as po,s as _}from "./_plugin-vue_export-helper-CVQjx7MO.js";const vo={class:"WorkFlowListContainer"},Wo={class:"card-header"},ho={class:"work-text"},Co={class:"work-text-title"},Io={key:0,style:{"font-size":"1.1rem",color:"#636363"}},mo={style:{"font-size":"0.8rem",color:"#b7b7b7"}},yo={class:"card-content"},Do={class:"card-header"},go={class:"work-text"},xo={key:0,style:{"font-size":"1.1rem",color:"#636363"}},Eo={style:{"font-size":"0.8rem",color:"#b7b7b7"}},Fo={class:"status-text"},Lo={class:"card-content-header"},To={class:"card-footer"},zo={class:"footerLeft"},Bo={key:0,class:"footerLeftItem"},Ro={key:1,class:"footerLeftItem"},Go={class:"footerRight"},No={__name:"WorkFlowList",setup($){const B=Q(),i=U("loading"),h=L([]),k=L({}),D=L({}),C=y(()=> l=>(k.value[l]||{}).status),R=y(()=> l=>(k.value[l]||{}).start_time),V=y(()=> l=>{const o=k.value[l]||{};return o.current_step?o.current_step:"--"}),P=y(()=> l=>{const o=D.value[l]||{};return o.flow_run_count?o.flow_run_count:0}),g=()=>{_.WorkFlowList().then(o=>{h.value=o.data,o.data.forEach(f=>{(f.WorkflowGroup||[]).forEach(u=>{k.value[u.WorkflowID]={status:u.WorkflowStatus,start_time:u.WorkflowStartTime,current_step:u.WorkflowCurrentStep},D.value[u.WorkflowID]={flow_run_count:u.WorkflowRunCount,current_step:u.WorkflowCurrentStep}}),i.close()})}).catch(o=>{console.log(o),i.close()})},G=(l, o)=>{i.show({text:o===1?"启动中....":"停止中....",timeout:6e4}),o===1?_.StartWork(l).then(I=>{g()}):_.StopWork(l).then(I=>{g()})},j=(l, o)=>{B.push({path:"/work",query:{id:l,work:o}})};return M(()=>{i.show({text:"加载中....",timeout:6e4}),_.init();let l=setInterval(()=>{_.isConnected===!0&&(g(),clearInterval(l))},1e3);_.socket.on("work_flow_list", o=>{k.value[o.WorkflowID]={status:o.WorkflowStatus,start_time:o.WorkflowStartTime,current_step:o.WorkflowCurrentStep}}),_.socket.on("work_flow_count", o=>{D.value[o.WorkflowID]={flow_run_count:o.WorkflowRunCount,current_step:o.WorkflowCurrentStep}})}),O(()=>{if(_.socket.off("work_flow_list"),_.socket.off("work_flow_count"),_.isConnected===!0){console.log("组件卸载"),_.disconnect();let l=setInterval(()=>{_.isConnected===!1&&clearInterval(l)},1e3)}}),(l, o)=>{const f=_o,I=co,u=fo,q=uo,x=to,E=oo,N=b,A=X("Clock"),F=lo,H=S,J=Z,K=Y;return a(),d("div",vo,[(a(!0),d(T,null,z(h.value, w=>(a(),p(H,{class:"WorkFlowListCard",shadow:"hover"},{header:t(()=>[n("div",Wo,[n("div",ho,[n("div",Co,[c(r(w.WorkflowClass)+" ",1),w.WorkflowTitle?(a(),d("span",Io,[s(f,{size:"large"},{default:t(()=>[c(r(w.WorkflowTitle),1)]),_:2},1024)])):v("",!0)]),n("div",mo,r(w.WorkflowDesc),1)])])]),default:t(()=>[n("div",yo,[s(K,{gutter:20},{default:t(()=>[(a(!0),d(T,null,z(w.WorkflowGroup, e=>(a(),p(J,{span:12,class:"WorkFlowListCol"},{default:t(()=>[s(H,{class:"WorkFlowListSubCard frosted-glass",shadow:"hover"},{header:t(()=>[n("div",Do,[n("div",go,[n("div",null,[c(r(e.WorkflowName)+" ",1),e.title?(a(),d("span",xo," （"+r(e.title)+"） ",1)):v("",!0)]),n("div",Eo," ID:"+r(e.WorkflowID)+" "+r(e.desc),1)]),n("div",Fo,[n("div",{class:io(["status-ball",C.value(e.WorkflowID)])},null,2),n("div",null,r(C.value(e.WorkflowID)),1)])])]),default:t(()=>[n("div",Lo,[s(I,{wrap:""},{default:t(()=>[s(f,null,{default:t(()=>[c("总步骤："+r(e.WorkflowStepInfo?e.WorkflowStepInfo.length:0),1)]),_:2},1024),s(f,{type:"success"},{default:t(()=>[c("当前步骤："+r(V.value(e.WorkflowID)),1)]),_:2},1024),s(f,{type:"warning"},{default:t(()=>[c("流程执行次数："+r(P.value(e.WorkflowID)),1)]),_:2},1024)]),_:2},1024)]),s(q,{class:"stepContainer","align-center":"","process-status":"wait"},{default:t(()=>[(a(!0),d(T,null,z(e.WorkflowStepInfo, m=>(a(),p(u,{title:m.title,style:{"min-width":"200px"}},null,8,["title"]))),256))]),_:2},1024)]),footer:t(()=>[n("div",To,[n("div",zo,[e.WorkflowRunType?(a(),d("div",Bo,[s(N,{class:"box-item",effect:"dark",content:"执行方式 single:单次执行 traversal:遍历执行 indefinitely:循环执行 custom:自定义执行 xxxx:自定义方法执行 ",placement:"top"},{default:t(()=>[s(E,null,{default:t(()=>[s(x,null,{default:t(()=>[s(W(eo))]),_:1}),c(" "+r(e.WorkflowRunType),1)]),_:2},1024)]),_:2},1024),s(N,{class:"box-item",effect:"dark",content:"参数类型",placement:"top"},{default:t(()=>[s(E,null,{default:t(()=>[s(x,null,{default:t(()=>[s(W(so))]),_:1}),c(" "+r(e.WorkflowRunData),1)]),_:2},1024)]),_:2},1024)])):v("",!0),R.value(e.WorkflowID)?(a(),d("div",Ro,[s(E,null,{default:t(()=>[s(x,null,{default:t(()=>[s(A)]),_:1}),c(" "+r(R.value(e.WorkflowID)),1)]),_:2},1024)])):v("",!0)]),n("div",Go,[s(F,{type:"primary",size:"small",icon:W(no),onClick: m=>j(e.WorkflowID,e.WorkflowName)},{default:t(()=>o[0]||(o[0]=[c("查看")])),_:2},1032,["icon","onClick"]),C.value(e.WorkflowID)!=="running"?(a(),p(F,{key:0,type:"success",size:"small",icon:W(ro),onClick: m=>G(e.WorkflowID,1)},{default:t(()=>o[1]||(o[1]=[c("启动")])),_:2},1032,["icon","onClick"])):C.value(e.WorkflowID)==="running"?(a(),p(F,{key:1,type:"danger",size:"small",icon:W(ao),onClick: m=>G(e.WorkflowID,2)},{default:t(()=>o[2]||(o[2]=[c("停止")])),_:2},1032,["icon","onClick"])):v("",!0)])])]),_:2},1024)]),_:2},1024))),256))]),_:2},1024)])]),_:2},1024))),256))])}}},Ho=po(No,[["__scopeId","data-v-629405cd"]]),$o={class:"line HomePageContainer"},jo={__name:"HomePage",setup($){return(B, i)=>{const h=ko,k=wo;return a(),d("div",$o,[s(h,{icon:"",title:""},{content:t(()=>i[0]||(i[0]=[n("div",{class:"flex items-center"},[n("span",{class:"headers-title"}," 工作列表 ")],-1)])),_:1}),s(k),s(Ho)])}}};export{jo as default};
