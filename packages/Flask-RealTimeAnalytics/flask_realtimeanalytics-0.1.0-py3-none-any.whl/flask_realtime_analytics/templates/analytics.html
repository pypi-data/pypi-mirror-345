<!DOCTYPE html>
<html>
<head>
    <title>Real-Time Analytics</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.5/socket.io.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-6">
    <div class="max-w-4xl mx-auto bg-white p-6 rounded-lg shadow">
        <h1 class="text-2xl font-bold mb-4">Real-Time Analytics Dashboard</h1>
        <div id="stats" class="space-y-4">
            <p><strong>Total Requests:</strong> <span id="total-requests">{{ stats.total_requests }}</span></p>
            <p><strong>Average Response Time:</strong> <span id="avg-response-time">{{ stats.avg_response_time }}s</span></p>
            <div>
                <strong>Requests by Endpoint:</strong>
                <ul id="endpoint-counts" class="list-disc pl-6">
                    {% for endpoint, count in stats.endpoint_counts.items() %}
                        <li>{{ endpoint }}: <span>{{ count }}</span></li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </div>
    <script>
        const socket = io();
        socket.on('analytics_update', (data) => {
            document.getElementById('total-requests').textContent = data.total_requests;
            document.getElementById('avg-response-time').textContent = data.avg_response_time + 's';
            const endpointList = document.getElementById('endpoint-counts');
            endpointList.innerHTML = '';
            for (const [endpoint, count] of Object.entries(data.endpoint_counts)) {
                const li = document.createElement('li');
                li.textContent = `${endpoint}: ${count}`;
                endpointList.appendChild(li);
            }
        });
    </script>
</body>
</html>