{% extends "base.html" %}

{% block title %}üìö –°–ø–∏—Å–æ–∫ —Ç–µ–º{% endblock %}

{% block content %}
    <h1>üìö –°–ø–∏—Å–æ–∫ –≤–∏–≤—á–µ–Ω–∏—Ö —Ç–µ–º</h1>

    {% if errors %}
        <div class="alert alert-warning">
            <h4>‚ö†Ô∏è –£–≤–∞–≥–∞! –ó–Ω–∞–π–¥–µ–Ω–æ –ø–æ–º–∏–ª–∫–∏ –≤ –¥–∞–Ω–∏—Ö:</h4>
            <ul>
                {% for error in errors %}
                    <li>{{ error }}</li>
                {% endfor %}
            </ul>
        </div>
    {% endif %}

    <label for="sort_by">–°–æ—Ä—Ç—É–≤–∞—Ç–∏ –∑–∞:</label>
    <select id="sort_by" class="form-select" onchange="sortTopics()">
        <option value="score">–û—Ü—ñ–Ω–∫–æ—é</option>
        <option value="time">–ß–∞—Å–æ–º –Ω–∞–≤—á–∞–Ω–Ω—è</option>
    </select>

    <table class="table table-striped mt-3">
        <thead>
            <tr>
                <th>üìå –¢–µ–º–∞</th>
                <th>‚è± –ß–∞—Å –Ω–∞–≤—á–∞–Ω–Ω—è (—Ö–≤)</th>
                <th>üìä –û—Ü—ñ–Ω–∫–∞</th>
                <th>üîó –ü–æ—Å–∏–ª–∞–Ω–Ω—è</th>
            </tr>
        </thead>
        <tbody id="topics_table">
            {% for abbr, topic in topics.items() %}
                <tr>
                    <td>{{ topic.theme }}</td>
                    <td data-time="{{ topic.actual if topic.actual is not none else 0 }}">{{ topic.actual if topic.actual is not none else '–ù–µ–≤—ñ–¥–æ–º–æ' }}</td>
                    <td data-score="{{ topic.score if topic.score is not none else 0 }}">{{ topic.score if topic.score is not none else '–ù–µ–≤—ñ–¥–æ–º–æ' }}/10</td>
                    <td><a href="{{ url_for('topic_detail', abbr=abbr) }}">–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏</a></td>
                </tr>
            {% endfor %}
        </tbody>
    </table>

    <script>
        function sortTopics() {
            let table = document.getElementById("topics_table");
            let rows = Array.from(table.rows);
            let sortBy = document.getElementById("sort_by").value;

            rows.sort((a, b) => {
                let valA = parseInt(a.cells[sortBy === "time" ? 1 : 2].dataset[sortBy]) || 0;
                let valB = parseInt(b.cells[sortBy === "time" ? 1 : 2].dataset[sortBy]) || 0;
                return valB - valA;
            });

            rows.forEach(row => table.appendChild(row));
        }
    </script>
{% endblock %}
