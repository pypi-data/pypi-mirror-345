(this["webpackJsonpstreamlit-video-timeline"]=this["webpackJsonpstreamlit-video-timeline"]||[]).push([[0],{15:function(e,t,r){},16:function(e,t,r){"use strict";r.r(t);var n=r(1),o=r.n(n),a=r(5),c=r.n(a),s=r(3),i=r(0);var l=Object(s.b)((e=>{let{args:t,theme:r}=e;const o=Object(n.useRef)(!1),a=Object(n.useRef)(null),c=r||{base:"light",primaryColor:"#000",backgroundColor:"#fff",secondaryBackgroundColor:"#f0f0f0",textColor:"#000",font:"sans-serif"},l=Object(n.useRef)(null),d=Object(n.useRef)(null),[u,m]=Object(n.useState)(!1),[b,h]=Object(n.useState)(0),[j,g]=Object(n.useState)(0),[f,v]=Object(n.useState)(0),[O,p]=Object(n.useState)([]),x=Object(n.useRef)(null),A=Object(n.useRef)(null),[C,y]=Object(n.useState)(100),[k,w]=Object(n.useState)(100),M=(Object(n.useRef)(0),Object(n.useRef)(0)),N=Object(n.useRef)(0),R=Object(n.useRef)(null);Object(n.useEffect)((()=>{s.a.setComponentReady();const e=l.current;if(e)return e.addEventListener("loadedmetadata",(()=>{console.log(`Video loaded with duration: ${e.duration} seconds`),v(e.duration);const t=Math.min(300,Math.max(50,Math.ceil(e.duration/3)));console.log(`Setting thumbnail count to: ${t} based on duration: ${e.duration}`),y(t);const r=Math.min(1e3,Math.max(100,Math.ceil(2*e.duration)));console.log(`Setting waveform count to: ${r} based on duration: ${e.duration}`),w(r),L(e)})),e.addEventListener("error",(t=>{var r,n;console.error("Video loading error:",t),console.error("Video error code:",null===(r=e.error)||void 0===r?void 0:r.code),console.error("Video error message:",null===(n=e.error)||void 0===n?void 0:n.message)})),()=>{x.current&&x.current.close(),e.removeEventListener("loadedmetadata",(()=>{}))}}),[]),Object(n.useEffect)((()=>{if(t.height)return;const e=R.current;if(!e)return;const r=new ResizeObserver((()=>{const t=e.getBoundingClientRect().height;s.a.setFrameHeight(t)}));return r.observe(e),s.a.setFrameHeight(e.getBoundingClientRect().height),()=>r.disconnect()}),[t.height]);const $=e=>{const t=Math.floor(e/60),r=Math.floor(e%60);return`${t}:${r<10?"0"+r:r}.${Math.floor(e%1*10)}`},E=e=>t=>{t.preventDefault(),d.current&&(o.current=!0,a.current=e,M.current=t.clientX,N.current="start"===e?b:j,console.log("Drag start",{markerType:e,initialMouseX:t.clientX,initialTime:N.current}),document.addEventListener("mousemove",S),document.addEventListener("mouseup",D))},S=e=>{if(!o.current||!d.current||!a.current||f<=0)return;const t=d.current.getBoundingClientRect().width,r=e.clientX-M.current,n=r/t*f;let c=N.current+n;c=Math.max(0,Math.min(f,c)),c=Math.round(20*c)/20,console.log("Dragging",{deltaX:r,deltaTime:n,newTime:c}),"start"===a.current?c<j&&h(c):c>b&&g(c)},D=()=>{o.current=!1,a.current=null,document.removeEventListener("mousemove",S),document.removeEventListener("mouseup",D)},B=e=>()=>{l.current&&(l.current.currentTime=e)},L=e=>{const t=new AudioContext,r=t.createAnalyser();r.fftSize=256;const n=r.frequencyBinCount,o=new Uint8Array(n);t.createMediaElementSource(e).connect(r),r.connect(t.destination),x.current=t,A.current=r;const a=()=>{A.current&&(A.current.getByteFrequencyData(o),p(Array.from(o)),requestAnimationFrame(a))};a()};return Object(i.jsx)("div",{ref:R,style:{fontFamily:c.font,color:c.textColor,backgroundColor:c.backgroundColor,padding:"10px",height:t.height?t.height:"auto"},children:Object(i.jsxs)("div",{className:"container",children:[Object(i.jsxs)("video",{ref:l,controls:!0,style:{width:"100%",maxWidth:"100%"},onLoadedData:()=>console.log("Video data loaded successfully"),onError:e=>console.error("Video loading error:",e),onTimeUpdate:()=>{l.current&&console.log(`Current time: ${l.current.currentTime}, Duration: ${l.current.duration}`)},children:[Object(i.jsx)("source",{src:t.video_url,type:"video/mp4"}),"Your browser does not support the video tag."]}),Object(i.jsxs)("div",{className:"timeline-wrapper",children:[Object(i.jsxs)("div",{className:"timeline-labels",children:[Object(i.jsx)("div",{className:"timeline-label",style:{paddingBottom:"10px",paddingTop:"10px"},children:"VIDEO"}),Object(i.jsx)("div",{className:"timeline-label",children:"AUDIO"})]}),Object(i.jsxs)("div",{className:"timeline-container",ref:d,children:[Object(i.jsx)("div",{className:"video-track",children:Object(i.jsx)("div",{className:"frame-thumbnails",children:t.frame_data&&t.frame_data.length>0?t.frame_data.map(((e,r)=>Object(i.jsx)("div",{className:"frame-thumbnail",style:{backgroundImage:`url("${e}")`,width:100/t.frame_data.length+"%"}},r))):Array.from({length:C}).map(((e,t)=>Object(i.jsx)("div",{className:"frame-thumbnail",style:{backgroundImage:'url("data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==")',width:100/C+"%"}},t)))})}),Object(i.jsx)("div",{className:"audio-track",children:Object(i.jsx)("div",{className:"audio-waveform",children:t.waveform_data&&t.waveform_data.length>0?t.waveform_data.map(((e,t)=>{const r=100*Math.max(e,.2);return Object(i.jsx)("div",{className:"waveform-bar",style:{height:`${r}%`,backgroundColor:c.primaryColor||"rgba(255, 75, 75, 0.8)"}},t)})):Array.from({length:k}).map(((e,t)=>{const r=20+15*Math.sin(t*Math.PI/10);return Object(i.jsx)("div",{className:"waveform-bar",style:{height:`${r}%`,backgroundColor:c.primaryColor||"rgba(255, 75, 75, 0.8)",flexBasis:100/k+"%",minWidth:0}},t)}))})}),u&&Object(i.jsxs)(i.Fragment,{children:[Object(i.jsx)("div",{className:"crop-marker",style:{left:`calc(${b/f*100}% - 1px)`,cursor:"ew-resize"},onMouseDown:E("start"),onDoubleClick:B(b),children:Object(i.jsx)("div",{className:"crop-label",children:$(b)})}),Object(i.jsx)("div",{className:"crop-marker",style:{left:`calc(${j/f*100}% - 1px)`,cursor:"ew-resize"},onMouseDown:E("end"),onDoubleClick:B(j),children:Object(i.jsx)("div",{className:"crop-label",children:$(j)})})]})]})]}),Object(i.jsx)("div",{className:"button-container",children:u?Object(i.jsxs)(i.Fragment,{children:[Object(i.jsx)("button",{className:"btn",onClick:()=>{s.a.setComponentValue({start:b,end:j,shouldRefreshTaskList:!0})},style:{backgroundColor:c.primaryColor},children:"Aplicar Corte"}),Object(i.jsx)("button",{className:"btn",onClick:()=>m(!1),style:{backgroundColor:c.primaryColor},children:"Cancelar"})]}):Object(i.jsx)("button",{className:"btn",onClick:()=>{if(!u){l.current&&l.current.pause(),console.log(`Setting crop markers for toggle: video duration = ${f}`);const e=Math.round(20)/20,t=Math.round(20*Math.max(f-1,.75*f))/20;console.log(`Setting crop markers at: start=${e}, end=${t}`),h(e),g(t)}m(!u)},style:{backgroundColor:c.primaryColor},children:"Modo de Corte"})})]})})}));r(15);c.a.render(Object(i.jsx)(o.a.StrictMode,{children:Object(i.jsx)(l,{})}),document.getElementById("root"))}},[[16,1,2]]]);