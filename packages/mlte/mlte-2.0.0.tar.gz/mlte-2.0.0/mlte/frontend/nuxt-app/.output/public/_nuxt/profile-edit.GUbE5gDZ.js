import{n as F,u as h,v as R,r as v,q as k,A as w,w as o,B as T,o as _,d as s,a as y,t as A,y as a,x as b,c as q,b as c,C as E,z as S,G as $}from"./entry.DZxwSL9U.js";import{u as z}from"./fetch.DQpSruNE.js";import{r as G}from"./util.B0gNYUhE.js";import{c as I,i as L}from"./form-methods.CkGHM49X.js";import{r as D,h as H}from"./http-error-handling.BbcmLHJS.js";const j=y("title",null,"Edit Profile",-1),J={class:"section-header",style:{display:"inline"}},K={key:2},M={class:"submit-footer"},ee=F({__name:"profile-edit",async setup(O){let f,C;const P=S(),V=h("token"),B=h("user"),{data:l}=([f,C]=R(()=>z(P.public.apiPath+"/user/me",{retry:0,method:"GET",headers:{Authorization:"Bearer "+V.value}},"$TnEsnvB9L2")),f=await f,C(),f),u=v(!1),n=v(""),i=v(""),d=v({password:!1,confirmPassword:!1});function g(){n.value="",i.value="",u.value=!0}function U(){u.value=!1,n.value="",i.value=""}async function x(){d.value=G(d.value);let m=!1;if(u.value&&(n.value.trim()===""&&(d.value.password=!0,m=!0),n.value!==i.value&&(d.value.confirmPassword=!0,m=!0)),m){L();return}try{const e={username:l.value.username,email:l.value.email,full_name:l.value.full_name,disabled:!1,role:l.value.role};u.value&&(e.password=n.value),await $fetch(P.public.apiPath+"/user",{retry:0,method:"PUT",headers:{Authorization:"Bearer "+V.value},body:e,onRequestError(){D()},onResponse({response:t}){t.ok&&$("/")},onResponseError({response:t}){H(t.status,t._data.error_description)}})}catch{}}return(m,e)=>{const t=k("UsaButton"),p=k("UsaTextInput"),N=T;return _(),w(N,{name:"base-layout"},{"page-title":o(()=>[s("Edit Profile")]),default:o(()=>[j,y("h2",J,A(a(B)),1),a(u)?b("",!0):(_(),w(t,{key:0,class:"secondary-button sub-header-float-button",onClick:g},{default:o(()=>[s(" Change Password ")]),_:1})),a(u)?(_(),w(t,{key:1,class:"secondary-button sub-header-float-button",onClick:U},{default:o(()=>[s(" Cancel Change ")]),_:1})):b("",!0),a(u)?(_(),q("div",K,[c(p,{modelValue:a(n),"onUpdate:modelValue":e[0]||(e[0]=r=>E(n)?n.value=r:null),error:a(d).password,type:"password"},{label:o(()=>[s(" New Password ")]),"error-message":o(()=>[s(" Password is required ")]),_:1},8,["modelValue","error"]),c(p,{modelValue:a(i),"onUpdate:modelValue":e[1]||(e[1]=r=>E(i)?i.value=r:null),error:a(d).confirmPassword,type:"password"},{label:o(()=>[s(" Confirm New Password ")]),"error-message":o(()=>[s(" Passwords to not match ")]),_:1},8,["modelValue","error"])])):b("",!0),c(p,{modelValue:a(l).email,"onUpdate:modelValue":e[2]||(e[2]=r=>a(l).email=r)},{label:o(()=>[s(" Email ")]),_:1},8,["modelValue"]),c(p,{modelValue:a(l).full_name,"onUpdate:modelValue":e[3]||(e[3]=r=>a(l).full_name=r)},{label:o(()=>[s(" Full Name ")]),_:1},8,["modelValue"]),y("div",M,[c(t,{class:"primary-button",onClick:e[4]||(e[4]=r=>("cancelFormSubmission"in m?m.cancelFormSubmission:a(I))("/"))},{default:o(()=>[s(" Cancel ")]),_:1}),c(t,{class:"primary-button",onClick:e[5]||(e[5]=r=>x())},{default:o(()=>[s(" Save ")]),_:1})])]),_:1})}}});export{ee as default};
