#name: Publish to PyPI using uv
#
#on:
#  release:
#    types: [published]
#
#permissions:
#  contents: read
#  id-token: write  # PyPI trusted publishing requires this
#
#jobs:
#  uv-publish:
#    runs-on: ubuntu-latest
#
#    steps:
#      - name: Checkout code
#        uses: actions/checkout@v4
#
#      - name: Install uv
#        uses: astral-sh/setup-uv@v5
#
##      - name: Install uv
##        run: pipx install uv
#
#      - name: Publish to PyPI with uv
#        # uvx --from=toml-cli toml set --toml-path=pyproject.toml project.version $CI_COMMIT_TAG
#        # uv publish dist/*.whl
#        run: |
#          uv build
#          uv publish
#
        


name: Publish to PyPI using uv

on:
  push:
    tags:
      - '*'  # 모든 태그 push 시 작동

permissions:
  contents: read  # 역할 뭐지?
  id-token: write
  attestations: write

jobs:
  uv-publish:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Install uv
        uses: astral-sh/setup-uv@v5

      - name: build pkg
        run: |
          uv build

#      - name: Generate artifact attestation
#        uses: actions/attest-build-provenance@v2
#        with:
#          subject-path: "dist/*"


#      - name: Download all the dists
#        uses: actions/download-artifact@v4
#        with:
#          name: python-package-distributions
#          path: dist/

      - name: Sign the dists with Sigstore
        uses: sigstore/gh-action-sigstore-python@v3.0.0
        with:
          inputs: >-
            ./dist/*.tar.gz
            ./dist/*.whl
          release-signing-artifacts: true

      - name: Generate artifact attestation
        uses: actions/attest-build-provenance@v2
        with:
          subject-path: "dist/*"

      - name: Publish to PyPI with uv
        run: |
          uv publish
        
