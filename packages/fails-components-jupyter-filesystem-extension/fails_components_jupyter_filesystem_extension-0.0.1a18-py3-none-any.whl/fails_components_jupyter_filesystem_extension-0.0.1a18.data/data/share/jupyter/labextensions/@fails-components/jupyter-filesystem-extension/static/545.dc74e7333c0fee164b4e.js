"use strict";(self.webpackChunk_fails_components_jupyter_filesystem_extension=self.webpackChunk_fails_components_jupyter_filesystem_extension||[]).push([[545],{545:(e,t,n)=>{n.r(t),n.d(t,{default:()=>f,failsContentsPlugin:()=>m});var i=n(573),s=n(323),r=n(262);const a="application/json";class o{constructor(){this._fileContent=JSON.stringify(o.EMPTY_NB),this._fileName="unloaded.ipynb",this._ready=new r.PromiseDelegate,window.failsCallbacks||(window.failsCallbacks={}),this._failsCallbacks=window.failsCallbacks,this._failsCallbacks.callContents=this.onMessage.bind(this)}async onMessage(e){switch(e.task){case"loadFile":{const t=e;this._fileContent=JSON.stringify(t.fileData||o.EMPTY_NB),this._fileName=t.fileName}break;case"savedFile":{const t=e;return this._fileName!==t.fileName?{error:"Filename not found"}:{fileData:JSON.parse(this._fileContent)}}}}get ready(){return this._ready.promise}async initialize(){this._ready.resolve(void 0)}async get(e,t){e=decodeURIComponent(e.replace(/^\//,""));const n={name:this._fileName,path:this._fileName,last_modified:new Date(0).toISOString(),created:new Date(0).toISOString(),format:"json",mimetype:a,content:JSON.parse(this._fileContent),size:0,writable:!0,type:"notebook"};return""===e?{name:"",path:e,last_modified:new Date(0).toISOString(),created:new Date(0).toISOString(),format:"json",mimetype:a,content:[n],size:0,writable:!0,type:"directory"}:e===this._fileName?n:null}async save(e,t={}){if((e=decodeURIComponent(e))!==this._fileName)return null;const n=t.chunk,i=!!n&&(n>1||-1===n);let s=await this.get(e,{content:i});if(!s)return null;const r=(new Date).toISOString();if(s={...s,...t,last_modified:r},t.content&&"base64"===t.format){const e=!n||-1===n,r=(new Date).toISOString();s={...s,...t,last_modified:r};const a=s.content,o=decodeURIComponent(escape(atob(t.content))),l=i?a+o:o;return s={...s,content:e?JSON.parse(l):l,format:"json",type:"notebook",size:l.length},this._fileContent=JSON.stringify(l),s}return this._fileContent=JSON.stringify(s.content),s}async newUntitled(e){throw new Error("NewUntitled not implemented")}async rename(e,t){throw new Error("rename not implemented")}async delete(e){throw new Error("delete not implemented")}async copy(e,t){throw new Error("copy not implemented")}async createCheckpoint(e){throw new Error("createCheckpoint not (yet?) implemented")}async listCheckpoints(e){return[{id:"fakeCheckpoint",last_modified:(new Date).toISOString()}]}async restoreCheckpoint(e,t){throw new Error("restoreCheckpoint not (yet?) implemented")}async deleteCheckpoint(e,t){throw new Error("deleteCheckpoint not (yet?) implemented")}}o.EMPTY_NB={metadata:{orig_nbformat:4},nbformat_minor:5,nbformat:4,cells:[]};var l=n(335),c=n(898);class d{static override(e){if(d._overrides[e.id]){e.schema.properties||(e.schema.properties={});for(const[t,n]of Object.entries(d._overrides[e.id]||{}))e.schema.properties[t].default=n}return e}constructor(){this._ready=new r.PromiseDelegate}get ready(){return this._ready.promise}async initialize(){this._ready.resolve(void 0)}async get(e){return(await this.getAll()).settings.find((t=>t.id===e))}async getAll(){const e=await this._getAll("all.json");let t=[];try{t=await this._getAll("all_federated.json")}catch(e){}const n=e.concat(t);return{settings:await Promise.all(n.map((async e=>{const t=e.raw;return{...d.override(e),raw:t,settings:c.parse(t)}})))}}async _getAll(e){var t;const n=null!==(t=l.PageConfig.getOption("settingsUrl"))&&void 0!==t?t:"/";return await(await fetch(l.URLExt.join(n,e))).json()}async save(e,t){}}d._overrides=JSON.parse(l.PageConfig.getOption("settingsOverrides")||"{}");const m={id:"@fails-components/jupyter-fails-server:contents",requires:[],autoStart:!0,provides:i.IContents,activate:e=>{"JupyterLite Server"!==e.namespace&&console.log("Not on server");const t=new o;return e.started.then((()=>t.initialize().catch(console.warn))),t}},p={id:"@fails-components/jupyter-fails-server:settings",requires:[],autoStart:!0,provides:s.ISettings,activate:e=>{"JupyterLite Server"!==e.namespace&&console.log("Not on server");const t=new d;return e.started.then((()=>t.initialize().catch(console.warn))),t}},f=[m,p]}}]);