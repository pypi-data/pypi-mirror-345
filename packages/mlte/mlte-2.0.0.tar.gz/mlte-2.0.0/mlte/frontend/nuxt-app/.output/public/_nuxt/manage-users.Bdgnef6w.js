import{n as D,q as C,o as f,c as p,a as u,F as M,s as j,t as B,b as m,w as r,d as s,u as L,r as w,v as H,y as i,A as S,x as g,C as T,z as I,B as K}from"./entry.DZxwSL9U.js";import{u as J}from"./fetch.DQpSruNE.js";import{r as Q}from"./util.B0gNYUhE.js";import{i as W}from"./form-methods.CkGHM49X.js";import{r as F,h as q}from"./http-error-handling.BbcmLHJS.js";const X={class:"table usa-table usa-table--borderless"},Y=u("thead",null,[u("tr",null,[u("th",{"data-sortable":"",scope:"col",role:"columnheader"},"Username"),u("th",{"data-sortable":"",scope:"col",role:"columnheader"},"Email"),u("th",{"data-sortable":"",scope:"col",role:"columnheader"},"Full Name"),u("th",{"data-sortable":"",scope:"col",role:"columnheader"},"Disabled"),u("th",{scope:"col",role:"columnheader"},"Actions")])],-1),Z={class:"centered-container",style:{"margin-bottom":"1.5em"}},O=D({__name:"user-list",props:{modelValue:{type:Array,required:!0,default:[]}},emits:["addUser","editUser","deleteUser"],setup(t,{emit:E}){const b=t;return(k,l)=>{const y=C("UsaCheckbox"),h=C("UsaButton");return f(),p("table",X,[Y,u("tbody",null,[(f(!0),p(M,null,j(b.modelValue,(n,V)=>(f(),p("tr",{key:V},[u("td",null,B(n.username),1),u("td",null,B(n.email),1),u("td",null,B(n.full_name),1),u("td",null,[u("div",Z,[m(y,{modelValue:n.disabled,"onUpdate:modelValue":U=>n.disabled=U,disabled:""},null,8,["modelValue","onUpdate:modelValue"])])]),u("td",null,[m(h,{class:"secondary-button",onClick:U=>k.$emit("editUser",n)},{default:r(()=>[s(" Edit ")]),_:2},1032,["onClick"]),m(h,{class:"usa-button usa-button--secondary",onClick:U=>k.$emit("deleteUser",n.username)},{default:r(()=>[s(" Delete ")]),_:2},1032,["onClick"])])]))),128))])])}}}),ee={key:0},ae={class:"section-header",style:{display:"inline"}},le={key:2},oe={key:1},se={class:"multi-line-checkbox-div"},te=u("label",{class:"usa-label"},"Groups",-1),re={key:0},ne=u("b",null,"create-model",-1),ue={class:"submit-footer"},de=D({__name:"user-edit",props:{modelValue:{type:Object,required:!0,default:{username:"",password:"",email:"",full_name:"",disabled:!1,role:"regular",groups:[]}},newUserFlag:{type:Boolean,required:!0,default:!1}},emits:["cancel","submit","updateUserGroups"],async setup(t,{emit:E}){let b,k;const l=t,y=I(),h=L("token"),n=w(!1),V=w(""),U=w([{value:"admin",text:"admin"},{value:"regular",text:"regular"}]),c=w({username:!1,role:!1,password:!1,confirmPassword:!1}),$=w([]),{data:R}=([b,k]=H(()=>J(y.public.apiPath+"/groups/details",{retry:0,method:"GET",headers:{Authorization:"Bearer "+h.value}},"$CRreKmBvzB")),b=await b,k(),b);R.value&&R.value.forEach(e=>{$.value.push({name:e.name,permissions:e.permissions,selected:!1})}),$.value.forEach(e=>{l.modelValue.groups.find(a=>a.name===e.name)&&(e.selected=!0)}),l.newUserFlag&&(l.modelValue.role="regular");function N(){n.value=!0,l.modelValue.password=""}function A(){n.value=!1,delete l.modelValue.password}function z(e,a){if(e)l.modelValue.groups.push({name:a.name,permissions:a.permissions});else{const _=l.modelValue.groups.find(P=>P.name===a.name),v=l.modelValue.groups.indexOf(_);l.modelValue.groups.splice(v,1)}}async function d(){c.value=Q(c.value);let e=!1;if(l.newUserFlag&&(l.modelValue.username.trim()===""&&(c.value.username=!0,e=!0),l.modelValue.password.trim()===""&&(c.value.password=!0,e=!0)),n.value&&(l.modelValue.password.trim()===""&&(c.value.password=!0,e=!0),l.modelValue.password!==V.value&&(c.value.confirmPassword=!0,e=!0)),l.modelValue.role.trim()===""&&(c.value.role=!0,e=!0),e){W();return}emit("submit",l.modelValue)}return(e,a)=>{const _=C("UsaButton"),v=C("UsaTextInput"),P=C("UsaCheckbox"),x=C("UsaSelect");return f(),p("div",null,[t.newUserFlag?g("",!0):(f(),p("div",ee,[u("h2",ae,B(t.modelValue.username),1),i(n)?g("",!0):(f(),S(_,{key:0,class:"secondary-button sub-header-float-button",onClick:N},{default:r(()=>[s(" Change Password ")]),_:1})),i(n)?(f(),S(_,{key:1,class:"secondary-button sub-header-float-button",onClick:A},{default:r(()=>[s(" Cancel Change ")]),_:1})):g("",!0),i(n)?(f(),p("div",le,[m(v,{modelValue:t.modelValue.password,"onUpdate:modelValue":a[0]||(a[0]=o=>t.modelValue.password=o),error:i(c).password,type:"password"},{label:r(()=>[s(" New Password ")]),"error-message":r(()=>[s(" Password is required ")]),_:1},8,["modelValue","error"]),m(v,{modelValue:i(V),"onUpdate:modelValue":a[1]||(a[1]=o=>T(V)?V.value=o:null),error:i(c).confirmPassword,type:"password"},{label:r(()=>[s(" Confirm New Password ")]),"error-message":r(()=>[s(" Passwords to not match ")]),_:1},8,["modelValue","error"])])):g("",!0)])),t.newUserFlag?(f(),p("div",oe,[m(v,{modelValue:t.modelValue.username,"onUpdate:modelValue":a[2]||(a[2]=o=>t.modelValue.username=o),error:i(c).username},{label:r(()=>[s(" Username ")]),"error-message":r(()=>[s(" Username is required ")]),_:1},8,["modelValue","error"]),m(v,{modelValue:t.modelValue.password,"onUpdate:modelValue":a[3]||(a[3]=o=>t.modelValue.password=o),error:i(c).password,type:"password"},{label:r(()=>[s(" Password ")]),"error-message":r(()=>[s(" Password is required ")]),_:1},8,["modelValue","error"])])):g("",!0),m(v,{modelValue:t.modelValue.email,"onUpdate:modelValue":a[4]||(a[4]=o=>t.modelValue.email=o)},{label:r(()=>[s(" Email ")]),_:1},8,["modelValue"]),m(v,{modelValue:t.modelValue.full_name,"onUpdate:modelValue":a[5]||(a[5]=o=>t.modelValue.full_name=o)},{label:r(()=>[s(" Full Name ")]),_:1},8,["modelValue"]),m(P,{modelValue:t.modelValue.disabled,"onUpdate:modelValue":a[6]||(a[6]=o=>t.modelValue.disabled=o),label:"Disabled"},null,8,["modelValue"]),m(x,{modelValue:t.modelValue.role,"onUpdate:modelValue":a[7]||(a[7]=o=>t.modelValue.role=o),options:i(U),error:i(c).role,onChange:a[8]||(a[8]=o=>i(c).role=!1)},{label:r(()=>[s(" Role ")]),"error-message":r(()=>[s(" A role must be selected ")]),_:1},8,["modelValue","options","error"]),u("div",se,[te,t.newUserFlag?(f(),p("div",re,[s(" User will automatically be added to the "),ne,s(" group upon submission. ")])):g("",!0),(f(!0),p(M,null,j(i($),o=>(f(),p("span",{key:o.name,class:"multiple-per-line-checkbox"},[m(P,{modelValue:o.selected,"onUpdate:modelValue":[G=>o.selected=G,G=>z(o.selected,o)]},{default:r(()=>[s(B(o.name),1)]),_:2},1032,["modelValue","onUpdate:modelValue"])]))),128))]),u("div",ue,[m(_,{class:"primary-button",onClick:a[9]||(a[9]=o=>e.$emit("cancel"))},{default:r(()=>[s(" Cancel ")]),_:1}),m(_,{class:"primary-button",onClick:d},{default:r(()=>[s(" Save ")]),_:1})])])}}}),ie=u("title",null,"Manage Users",-1),me={key:0},ce={key:1},ve=D({__name:"manage-users",setup(t){const E=I(),b=L("token"),k=L("user"),l=w(!1),y=w(!1),h=w([]),n=w({});V(),U();async function V(){await $fetch(E.public.apiPath+"/users/details",{retry:0,method:"GET",headers:{Authorization:"Bearer "+b.value},onRequestError(){F()},onResponse({response:d}){d.ok&&(h.value=d._data)},onResponseError({response:d}){q(d.status,d._data.error_description)}})}function U(){n.value={username:"",email:"",full_name:"",disabled:!1,role:"",groups:[],password:""}}function c(){U(),l.value=!0,y.value=!0}function $(d){n.value=d,l.value=!0,y.value=!1}async function R(d){if(k.value===d){alert("Cannot delete the active user.");return}confirm("Are you sure you want to delete user, "+d+"?")&&await $fetch(E.public.apiPath+"/user/"+d,{retry:0,method:"DELETE",headers:{Authorization:"Bearer "+b.value},onRequestError(){F()},onResponse({response:e}){e.ok&&V()},onResponseError({response:e}){q(e.status,e._data.error_description)}})}function N(){l.value&&A()}function A(){confirm("Are you sure you want to cancel? All changes will be lost.")&&(l.value=!1,U())}async function z(d){try{y.value?await $fetch(E.public.apiPath+"/user",{retry:0,method:"POST",headers:{Authorization:"Bearer "+b.value},body:d,onRequestError(){F()},onResponse({response:e}){e.ok&&V()},onResponseError({response:e}){q(e.status,e._data.error_description)}}):await $fetch(E.public.apiPath+"/user",{retry:0,method:"PUT",body:d,headers:{Authorization:"Bearer "+b.value},onRequestError(){F()},onResponse({response:e}){e.ok&&V()},onResponseError({response:e}){q(e.status,e._data.error_description)}})}catch{console.log("Error in submit.");return}alert("User has been saved successfully."),U(),l.value=!1}return(d,e)=>{const a=C("UsaButton"),_=O,v=de,P=K;return f(),S(P,{name:"base-layout",onManageUsers:N},{"page-title":r(()=>[s("Manage Users")]),default:r(()=>[ie,i(l)?g("",!0):(f(),p("div",me,[m(a,{class:"secondary-button sub-header-float-button",onClick:c},{default:r(()=>[s(" Add User ")]),_:1}),m(_,{modelValue:i(h),"onUpdate:modelValue":e[0]||(e[0]=x=>T(h)?h.value=x:null),onEditUser:$,onDeleteUser:R},null,8,["modelValue"])])),i(l)?(f(),p("div",ce,[m(v,{modelValue:i(n),"onUpdate:modelValue":e[1]||(e[1]=x=>T(n)?n.value=x:null),"new-user-flag":i(y),onCancel:A,onSubmit:z},null,8,["modelValue","new-user-flag"])])):g("",!0)]),_:1})}}});export{ve as default};
